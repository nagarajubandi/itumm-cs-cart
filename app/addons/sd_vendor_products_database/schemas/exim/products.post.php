<?php
 use Tygh\Registry; $addon_settings = Registry::get('addons.sd_vendor_products_database'); $schema['export_fields']['Price']['process_put'] = array('fn_sd_vendor_products_database_import_product_price', '#key', '#this', '%Vendor%'); $company_id = Registry::get('runtime.company_id'); if (!empty($company_id)) { $schema['references']['product_vendor_sell'] = array('reference_fields' => array('product_id' => '#key'), 'join_type' => 'LEFT', 'import_skip_db_processing' => true); $schema['condition']['use_company_condition'] = false; $schema['pre_export_process']['set_vendor_sell_condition'] = array( 'function' => 'fn_sd_vendor_products_database_set_vendor_sell_condition', 'args' => array('$conditions', '$options'), 'export_only' => true, ); } if ((ACCOUNT_TYPE == 'vendor' || !empty($company_id)) && Registry::get('runtime.mode') == 'export') { $schema['options']['export_all_products'] = array( 'title' => 'sd_vendor_products_database.export_all_products', 'description' => 'text_export_all_products', 'type' => 'checkbox', 'export_only' => true ); } if ((ACCOUNT_TYPE == 'vendor' || !empty($company_id)) && Registry::get('runtime.mode') == 'import') { $schema['update_only'] = $addon_settings['allow_vendors_create_products'] != 'Y'; $schema['condition']['use_company_condition'] = false; $schema['import_get_primary_object_id'] = array(); $schema['import_process_data']['check_allow_sharing'] = array( 'function' => 'fn_sd_vendor_products_database_check_allow_sharing', 'args' => array( '$primary_object_id', '$processed_data', '$object', '$skip_record' ), 'import_only' => true, ); unset($schema['import_process_data']['mve_import_check_object_id']); $schema['export_fields']['Price'] = array( 'linked' => false, 'convert_put' => array('fn_exim_import_price', '#this', '@price_dec_sign_delimiter'), 'process_put' => array('fn_sd_vendor_products_database_import_product_price', '#key', '#this'), ); $schema['export_fields']['Quantity'] = array( 'linked' => false, 'process_put' => array('fn_sd_vendor_products_database_import_product_amount', '#key', '#this'), ); } return $schema; 