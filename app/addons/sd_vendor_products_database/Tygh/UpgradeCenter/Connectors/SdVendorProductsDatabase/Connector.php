<?php
 namespace Tygh\UpgradeCenter\Connectors\SdVendorProductsDatabase; use Tygh\Addons\SchemesManager; use Tygh\Registry; use Tygh\UpgradeCenter\Connectors\BaseAddonConnector; class Connector extends BaseAddonConnector { protected $addon_version; public function __construct() { parent::__construct(); $addon_scheme = SchemesManager::getScheme('sd_vendor_products_database'); $this->updates_server = str_rot13('uggc://hctenqr.fvzgrpuqri.pbz'); if (Registry::get('settings.Security.secure_admin') == 'Y') { $this->updates_server = str_rot13('uggcf://hctenqr.fvzgrpuqri.pbz'); } $this->addon_id = $addon_scheme->getId(); $this->addon_version = $addon_scheme->getVersion(); $this->license_number = Registry::get(str_rot13('nqqbaf.fq_iraqbe_cebqhpgf_qngnonfr.yxrl')); $this->notification_key = 'upgrade_center:sd_vendor_products_database'; } public function getConnectionData() { $data = array( 'a' => $this->addon_id, 'av' => $this->addon_version, 'l' => $this->language, 'k' => $this->license_number, 'h' => Registry::get('config.current_host'), 'v' => PRODUCT_VERSION, 'e' => PRODUCT_EDITION, 'b' => PRODUCT_BUILD, 'p' => CS_PHP_VERSION, 'm' => $this->getMemTotal(), 'mf' => $this->getMemFree(), 'd' => (int) disk_total_space('/') / 1024, 'df' => (int) disk_free_space('/') / 1024, ); $request_data = array( 'method' => 'get', 'url' => $this->updates_server . '/index.php?dispatch=product_updates.get_available', 'data' => array( 'data' => base64_encode(json_encode($data)) ), 'headers' => array( 'Accept: application/xml' ) ); return $request_data; } private function getInfo($file, $key) { if (!isset($this->info[$file])) { if (file_exists($file)) { $this->info[$file] = file_get_contents($file); } else { $this->info[$file] = ''; } } $value = false; if (!empty($this->info[$file])) { preg_match('/' . $key . ':\s+(\d+)\skB/', $this->info[$file], $pieces); $value = filter_var($pieces[1], FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION | FILTER_FLAG_ALLOW_THOUSAND); $value = $value / 1024; } return $value; } private function getMemFree() { return (int) $this->getInfo('/proc/meminfo', 'MemFree'); } private function getMemTotal() { return (int) $this->getInfo('/proc/meminfo', 'MemTotal'); } } 